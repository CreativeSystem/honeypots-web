{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/home/kros/Desktop/www/creative/HoneyPots/honeypots-web/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/kros/Desktop/www/creative/HoneyPots/honeypots-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/home/kros/Desktop/www/creative/HoneyPots/honeypots-web/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/home/kros/Desktop/www/creative/HoneyPots/honeypots-web/src/contexts/AuthContext.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport { createContext, useEffect, useState } from \"react\";\nimport { api } from \"@/api\";\nimport ApiStatus from \"@/enums/ApiStatus\";\nimport usePersistedState from \"@/hooks/usePersistedState\";\nvar AuthContext = /*#__PURE__*/createContext({});\n\nvar AuthContextProvider = function AuthContextProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _useState = useState(null),\n      isSigned = _useState[0],\n      setIsSigned = _useState[1];\n\n  var _usePersistedState = usePersistedState(\"@token\", null),\n      _usePersistedState2 = _slicedToArray(_usePersistedState, 2),\n      token = _usePersistedState2[0],\n      setToken = _usePersistedState2[1];\n\n  var _useState2 = useState(\"\"),\n      id = _useState2[0],\n      setId = _useState2[1];\n\n  useEffect(function () {\n    function validate() {\n      return _validate.apply(this, arguments);\n    }\n\n    function _validate() {\n      _validate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return api.post(\"user/verify/\");\n\n              case 3:\n                response = _context.sent;\n\n                if (response.status !== 200) {\n                  setIsSigned(false);\n                } else {\n                  setIsSigned(true);\n                  setId(response.data.id);\n                }\n\n                _context.next = 10;\n                break;\n\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context[\"catch\"](0);\n                setIsSigned(false);\n\n              case 10:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 7]]);\n      }));\n      return _validate.apply(this, arguments);\n    }\n\n    if (token) {\n      api.defaults.headers.Authorization = \"Bearer \".concat(token);\n      validate();\n    } else {\n      setIsSigned(false);\n    }\n  }, [token]);\n\n  function logIn(_x, _x2) {\n    return _logIn.apply(this, arguments);\n  }\n\n  function _logIn() {\n    _logIn = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email, password) {\n      var response;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return api.post(\"token/\", {\n                email: email,\n                password: password\n              });\n\n            case 3:\n              response = _context2.sent;\n\n              if (!(response.status !== 200)) {\n                _context2.next = 6;\n                break;\n              }\n\n              return _context2.abrupt(\"return\", ApiStatus.HTTP_400_BAD_REQUEST);\n\n            case 6:\n              setToken(response.data.access);\n              api.defaults.headers.Authorization = \"Bearer \".concat(response.data.access);\n              setIsSigned(true);\n              return _context2.abrupt(\"return\", ApiStatus.HTTP_200_OK);\n\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2[\"catch\"](0);\n              return _context2.abrupt(\"return\", ApiStatus.ERROR);\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 12]]);\n    }));\n    return _logIn.apply(this, arguments);\n  }\n\n  function register(_x3, _x4, _x5) {\n    return _register.apply(this, arguments);\n  }\n\n  function _register() {\n    _register = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(name, email, password) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return api.post(\"user/create-find/\", {\n                name: name,\n                email: email,\n                password: password\n              });\n\n            case 3:\n              _context3.next = 8;\n              break;\n\n            case 5:\n              _context3.prev = 5;\n              _context3.t0 = _context3[\"catch\"](0);\n              throw new Error(_context3.t0);\n\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 5]]);\n    }));\n    return _register.apply(this, arguments);\n  }\n\n  function logOut() {\n    setToken(null);\n  }\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      id: id,\n      isSigned: isSigned,\n      token: token,\n      logIn: logIn,\n      register: register,\n      logOut: logOut\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(AuthContextProvider, \"/9q6jcw362DskTAYM4JQJvKsegM=\", false, function () {\n  return [usePersistedState];\n});\n\n_c = AuthContextProvider;\nexport { AuthContext, AuthContextProvider };\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthContextProvider\");","map":{"version":3,"sources":["/home/kros/Desktop/www/creative/HoneyPots/honeypots-web/src/contexts/AuthContext.tsx"],"names":["createContext","useEffect","useState","api","ApiStatus","usePersistedState","AuthContext","AuthContextProvider","children","isSigned","setIsSigned","token","setToken","id","setId","validate","post","response","status","data","defaults","headers","Authorization","logIn","email","password","HTTP_400_BAD_REQUEST","access","HTTP_200_OK","ERROR","register","name","Error","logOut"],"mappings":"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","sourcesContent":["import { createContext, useEffect, useState } from \"react\"\n\nimport { api } from \"@/api\"\nimport ApiStatus from \"@/enums/ApiStatus\"\nimport usePersistedState from \"@/hooks/usePersistedState\"\n\nexport interface AuthContextData {\n  id: string\n  isSigned: boolean | null\n  token: string | null\n  logIn(email: string, password: string): Promise<ApiStatus>\n  register(name: string, email: string, password: string): void\n  logOut(): void\n}\n\nconst AuthContext = createContext<AuthContextData>({} as AuthContextData)\n\nconst AuthContextProvider: React.FC = ({ children }) => {\n  const [isSigned, setIsSigned] = useState<boolean | null>(null)\n  const [token, setToken] = usePersistedState<string | null>(\"@token\", null)\n  const [id, setId] = useState<string>(\"\")\n\n  useEffect(() => {\n    async function validate() {\n      try {\n        const response = await api.post(\"user/verify/\")\n\n        if (response.status !== 200) {\n          setIsSigned(false)\n        } else {\n          setIsSigned(true)\n          setId(response.data.id)\n        }\n      } catch (err) {\n        setIsSigned(false)\n      }\n    }\n\n    if (token) {\n      api.defaults.headers.Authorization = `Bearer ${token}`\n\n      validate()\n    } else {\n      setIsSigned(false)\n    }\n  }, [token])\n\n  async function logIn(email: string, password: string): Promise<ApiStatus> {\n    try {\n      const response = await api.post(\"token/\", {\n        email: email,\n        password: password\n      })\n\n      if (response.status !== 200) {\n        return ApiStatus.HTTP_400_BAD_REQUEST\n      }\n\n      setToken(response.data.access)\n\n      api.defaults.headers.Authorization = `Bearer ${response.data.access}`\n\n      setIsSigned(true)\n\n      return ApiStatus.HTTP_200_OK\n    } catch (err) {\n      return ApiStatus.ERROR\n    }\n  }\n\n  async function register(name: string, email: string, password: string) {\n    try {\n      await api.post(\"user/create-find/\", {\n        name: name,\n        email: email,\n        password: password\n      })\n    } catch (error) {\n      throw new Error(error)\n    }\n  }\n\n  function logOut() {\n    setToken(null)\n  }\n\n  return (\n    <AuthContext.Provider\n      value={{ id, isSigned, token, logIn, register, logOut }}\n    >\n      {children}\n    </AuthContext.Provider>\n  )\n}\n\nexport { AuthContext, AuthContextProvider }\n"]},"metadata":{},"sourceType":"module"}